name: decoder/suricata-alert/0

sources:
  - decoder/suricata/0

metadata:
  module: suricata
  compatibility: <= v7
  author:
    name: Wazuh Inc, info@wazuh.com
    date: Nov 18 2022
  references:
    - https://suricata.readthedocs.io/en/suricata-6.0.8/output/eve/eve-json-format.html?highlight=eve%20format
  title: Suricata decoder
  description: Decoder for Suricata solution

definitions:
  ttotalBytes: +i_calc/sum/$source.bytes
  totalBytes: +i_calc/sum/$destination.bytes
  ttotalPackets: +i_calc/sum/$source.packets
  totalPackets: +i_calc/sum/$destination.packets
  ttotalTraffic: +i_calc/sum/$totalBytes
  totalTraffic: +i_calc/sum/$totalPackets

check:
  - suricata.eve.event_type: +s_eq/alert

normalize:
  - check: +i_gt/totalBytes/0
    map:
      - network.bytes: $totalBytes

  - check: +i_gt/totalPackets/0
    map:
      - network.packets: $totalPackets

  - map:
      - event.kind: alert
      - event.category: +a_append/intrusion_detection
      - rule.category: $suricata.eve.alert.category
      - rule.id: $suricata.eve.alert.signature_id
      - rule.name: $suricata.eve.alert.signature
      - event.severity: $suricata.eve.alert.severity
      - threat.tactic.id: $suricata.eve.alert.metadata.mitre_attack
      - threat.tactic.name: $suricata.eve.alert.metadata.mitre_tactic_name
      - threat.technique.id: $suricata.eve.alert.metadata.mitre_technique_id
      - threat.technique.name: $suricata.eve.alert.metadata.mitre_techinique_name
      - file.name: $suricata.eve.alert.metadata.filename

  - check:
      - threat.tactic.id: +t_is_null
    map:
      - threat.tactic.id: $suricata.eve.alert.metadata.mitre_attack_id

  - check:
      - suricata.eve.alert.action: +s_eq/bloqued
    map:
      - suricata.eve.alert.action: denied

  - check:
      - suricata.eve.alert.action: +t_is_not_null
    map:
      - event.type: +a_append/$suricata.eve.alert.action

  - check:
      - suricata.eve.event_type: "alert"
    map:
      - event.type: ["detail"]
